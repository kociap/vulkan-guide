<svg width="900" height="650" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="gigabufferGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3F51B5;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#1A237E;stop-opacity:0.8" />
    </linearGradient>
    <linearGradient id="chunkGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#2E7D32;stop-opacity:0.8" />
    </linearGradient>
    <linearGradient id="cpuGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#FF9800;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#E65100;stop-opacity:0.8" />
    </linearGradient>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    Chunk Architecture &amp; Gigabuffer System
  </text>
  
  <!-- CPU Side -->
  <rect x="50" y="60" width="350" height="250" fill="url(#cpuGradient)" rx="10" stroke="#E65100" stroke-width="2"/>
  <text x="225" y="85" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    CPU Side
  </text>
  
  <!-- Chunk Grid Visualization -->
  <text x="80" y="110" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    8x8x8 Chunk Grid
  </text>
  
  <!-- Draw some chunk cubes -->
  <g transform="translate(80,120)">
    <!-- Chunk 1 -->
    <g>
      <rect x="0" y="0" width="25" height="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
      <polygon points="25,0 35,8 35,33 25,25" fill="#2E7D32"/>
      <polygon points="0,0 10,8 35,8 25,0" fill="#66BB6A"/>
      <text x="12" y="18" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">0,0,0</text>
    </g>
    <!-- Chunk 2 -->
    <g transform="translate(40,0)">
      <rect x="0" y="0" width="25" height="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
      <polygon points="25,0 35,8 35,33 25,25" fill="#2E7D32"/>
      <polygon points="0,0 10,8 35,8 25,0" fill="#66BB6A"/>
      <text x="12" y="18" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">1,0,0</text>
    </g>
    <!-- Chunk 3 -->
    <g transform="translate(80,0)">
      <rect x="0" y="0" width="25" height="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
      <polygon points="25,0 35,8 35,33 25,25" fill="#2E7D32"/>
      <polygon points="0,0 10,8 35,8 25,0" fill="#66BB6A"/>
      <text x="12" y="18" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">2,0,0</text>
    </g>
    <!-- More chunks in second row -->
    <g transform="translate(0,35)">
      <rect x="0" y="0" width="25" height="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
      <polygon points="25,0 35,8 35,33 25,25" fill="#2E7D32"/>
      <polygon points="0,0 10,8 35,8 25,0" fill="#66BB6A"/>
      <text x="12" y="18" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">0,0,1</text>
    </g>
    <!-- Ellipsis -->
    <text x="150" y="40" font-family="Arial, sans-serif" font-size="16" fill="white">...</text>
  </g>
  
  <!-- ChunkDrawInfo structure -->
  <rect x="80" y="200" width="280" height="80" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1" rx="5"/>
  <text x="90" y="220" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">ChunkDrawInfo:</text>
  <text x="90" y="235" font-family="Courier, monospace" font-size="10" fill="white">• glm::ivec3 position</text>
  <text x="90" y="250" font-family="Courier, monospace" font-size="10" fill="white">• int16_t type, drawcount</text>
  <text x="90" y="265" font-family="Courier, monospace" font-size="10" fill="white">• int32_t index (into gigabuffer)</text>
  
  <!-- GPU Side -->
  <rect x="500" y="60" width="350" height="500" fill="url(#gigabufferGradient)" rx="10" stroke="#1A237E" stroke-width="2"/>
  <text x="675" y="85" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    GPU Side
  </text>
  
  <!-- Gigabuffer -->
  <rect x="530" y="100" width="290" height="200" fill="rgba(255,255,255,0.1)" stroke="white" stroke-width="2" rx="5"/>
  <text x="675" y="125" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Gigabuffer (400MB)
  </text>
  
  <!-- Suballocated regions -->
  <rect x="540" y="140" width="60" height="30" fill="#4CAF50" stroke="#2E7D32" rx="3"/>
  <text x="570" y="158" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk A</text>
  
  <rect x="610" y="140" width="80" height="30" fill="#FF9800" stroke="#E65100" rx="3"/>
  <text x="650" y="158" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk B</text>
  
  <rect x="700" y="140" width="40" height="30" fill="#9C27B0" stroke="#6A1B9A" rx="3"/>
  <text x="720" y="158" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk C</text>
  
  <rect x="750" y="140" width="60" height="30" fill="#F44336" stroke="#C62828" rx="3"/>
  <text x="780" y="158" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk D</text>
  
  <!-- More rows of chunks -->
  <rect x="540" y="180" width="70" height="30" fill="#2196F3" stroke="#1565C0" rx="3"/>
  <text x="575" y="198" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk E</text>
  
  <rect x="620" y="180" width="50" height="30" fill="#607D8B" stroke="#37474F" rx="3"/>
  <text x="645" y="198" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk F</text>
  
  <rect x="680" y="180" width="90" height="30" fill="#795548" stroke="#5D4037" rx="3"/>
  <text x="725" y="198" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Chunk G</text>
  
  <text x="675" y="240" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    VMA Virtual Allocation
  </text>
  <text x="675" y="255" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    32-bit offsets instead of 64-bit pointers
  </text>
  
  <!-- Block Data Format -->
  <rect x="530" y="320" width="290" height="120" fill="rgba(255,255,255,0.1)" stroke="white" stroke-width="2" rx="5"/>
  <text x="675" y="345" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Block Data Format (32-bit packed)
  </text>
  
  <!-- Bit breakdown -->
  <g transform="translate(550, 360)">
    <rect x="0" y="0" width="40" height="25" fill="#FF5722" stroke="white"/>
    <text x="20" y="17" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">4 bits</text>
    <text x="20" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">flags</text>
    
    <rect x="40" y="0" width="120" height="25" fill="#4CAF50" stroke="white"/>
    <text x="100" y="17" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">12 bits (4+4+4)</text>
    <text x="100" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">position (x,y,z)</text>
    
    <rect x="160" y="0" width="90" height="25" fill="#2196F3" stroke="white"/>
    <text x="205" y="17" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">16 bits</text>
    <text x="205" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">block type</text>
  </g>
  
  <text x="675" y="415" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
    Only visible surface blocks stored
  </text>
  
  <!-- Transfer Operation -->
  <rect x="530" y="460" width="290" height="80" fill="rgba(255,255,255,0.1)" stroke="white" stroke-width="2" rx="5"/>
  <text x="675" y="485" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Data Transfer
  </text>
  <text x="675" y="505" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    CPU staging buffer → Compute shader copy
  </text>
  <text x="675" y="520" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    No chunk updates (delete + recreate)
  </text>
  
  <!-- Data flow arrows -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Arrow from CPU to GPU -->
  <line x1="400" y1="180" x2="500" y2="180" stroke="#666" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="450" y="175" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">Upload</text>
  
  <!-- Performance notes -->
  <text x="450" y="590" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">
    Key Advantages
  </text>
  <text x="450" y="610" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">
    • Unified buffer for transfers • Memory-efficient packing • GPU-side allocation management
  </text>
  <text x="450" y="625" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">
    • Supports any chunk positioning within int32 bounds • Up to 400,000 chunks
  </text>
</svg>